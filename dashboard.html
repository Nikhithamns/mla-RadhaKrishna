<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp Dashboard</title>
<style>
  body { font-family: Arial; background:#f5f5f5; margin:0; }
  .container { max-width:900px; margin:50px auto; padding:30px; background:#fff; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.2);}
  h1,h2 { text-align:center; }
  .click-count { font-size:24px; text-align:center; margin-top:10px; color:#128C7E; font-weight:bold; }
  table { width:100%; border-collapse:collapse; margin-top:20px; }
  table th, table td { border:1px solid #ddd; padding:10px; font-size:14px; }
  table th { background:#25D366; color:#fff; }
  .back-btn { display:block; margin:20px auto; text-align:center; text-decoration:none; padding:10px 20px; background:#25D366; color:#fff; border-radius:8px; font-weight:bold;}
  .back-btn:hover { background:#128C7E; }
</style>
</head>
<body>
<div class="container">
  <h1>WhatsApp Button Dashboard</h1>
  <div class="click-count">Total Clicks: <span id="totalClicks">0</span></div>

  <h2>Recent Click Logs</h2>
  <table>
    <thead>
      <tr><th>Timestamp</th><th>Page</th><th>User Agent</th><th>IP</th></tr>
    </thead>
    <tbody id="logsTable"></tbody>
  </table>

  <a href="home.html" class="back-btn">Back to Home</a>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>

<script>
  const firebaseConfig = { databaseURL: "https://mla-site-default-rtdb.asia-southeast1.firebasedatabase.app" };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const totalEl = document.getElementById('totalClicks');
  const tableEl = document.getElementById('logsTable');

  const logsRef = db.ref('clickLogs');

  logsRef.on('value', snapshot => {
    tableEl.innerHTML = '';
    const data = snapshot.val();
    if (!data) { totalEl.textContent = 0; return; }

    const logs = Object.values(data).sort((a,b)=>b.ts - a.ts);
    totalEl.textContent = logs.length;

    logs.forEach(log => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${log.ts ? new Date(log.ts).toLocaleString() : '-'}</td>
                      <td>${log.path || '-'}</td>
                      <td>${log.ua || '-'}</td>
                      <td>${log.ip || '-'}</td>`;
      tableEl.appendChild(tr);
    });
  });
</script>
</body>
</html>
